# Meeting Service User Flow Documentation

This document outlines the expected user interaction and system behavior for each method within the `MeetingServiceImpl`.

## 1. `getAllMeetings(Long cursorId, int size)`

*   **목적:** 모든 공개 모임 목록을 페이지네이션하여 조회합니다. 사용자가 새로운 모임을 탐색할 때 사용됩니다.
*   **사용자 흐름:**
    *   사용자는 특정 카테고리나 조건 없이 최신 모임 목록을 확인하고 싶을 때 이 기능을 사용합니다.
    *   `cursorId`를 `0L`으로 설정하여 첫 페이지를 요청합니다.
    *   다음 페이지를 요청할 때는 이전 페이지의 마지막 모임 ID를 `cursorId`로 전달합니다.
*   **성공 시:** 요청된 `size`만큼의 모임 목록(또는 그 이하)을 반환합니다.
*   **실패 시:**
    *   내부 시스템 오류 발생 시, 사용자에게 일반적인 오류 메시지가 표시될 수 있습니다.

## 2. `getMeetingDetails(Long id)`

*   **목적:** 특정 모임의 상세 정보를 조회합니다.
*   **사용자 흐름:**
    *   사용자는 모임 목록에서 특정 모임을 선택하여 상세 내용을 확인하고 싶을 때 이 기능을 사용합니다.
*   **성공 시:** 모임의 제목, 호스트 정보, 장소, 시간, 상태, 태그 등 상세 정보를 반환합니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`: 요청된 `id`에 해당하는 모임이 존재하지 않을 경우, 사용자에게 "모임을 찾을 수 없습니다"와 같은 메시지가 표시됩니다.

## 3. `getAllMyMeetings(Member member, Long cursorId, int size, MeetingStatus meetingStatus)`

*   **목적:** 특정 사용자가 참여하거나 호스트하는 모임 목록을 상태별로 페이지네이션하여 조회합니다.
*   **사용자 흐름:**
    *   사용자는 자신이 참여 중이거나 생성한 모임들을 확인하고 싶을 때 이 기능을 사용합니다.
    *   `meetingStatus`를 통해 `ONGOING`, `COMPLETED` 등 특정 상태의 모임만 필터링할 수 있습니다.
*   **성공 시:** 요청된 `size`만큼의 해당 사용자의 모임 목록(또는 그 이하)을 반환합니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`: 요청한 `member`가 시스템에 존재하지 않을 경우, 사용자에게 "사용자를 찾을 수 없습니다"와 같은 메시지가 표시됩니다.

## 4. `countMeetings(Member member)`

*   **목적:** 특정 사용자가 참여하거나 호스트하는 모임의 총 개수를 조회합니다.
*   **사용자 흐름:**
    *   사용자는 자신의 모임 대시보드 등에서 총 모임 개수를 확인하고 싶을 때 사용합니다.
*   **성공 시:** 해당 사용자의 모임 총 개수를 반환합니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`: 요청한 `member`가 시스템에 존재하지 않을 경우, 사용자에게 "사용자를 찾을 수 없습니다"와 같은 메시지가 표시됩니다.

## 5. `joinMeeting(Long meetingId, Member member)`

*   **목적:** 사용자가 특정 모임에 참여합니다.
*   **사용자 흐름:**
    *   사용자는 참여하고 싶은 모임을 선택하고 참여 버튼을 누릅니다.
*   **성공 시:** 참여한 모임의 ID를 반환합니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`:
        *   모임이 존재하지 않거나,
        *   모임 상태가 `ONGOING`이 아닐 경우 (예: `COMPLETED`, `FULL` 등),
        *   참여자 수 조회 또는 저장 중 오류가 발생할 경우,
        *   사용자가 시스템에 존재하지 않을 경우,
        사용자에게 "모임에 참여할 수 없습니다" 또는 "모임을 찾을 수 없습니다"와 같은 메시지가 표시됩니다.
        *   **정원 초과 시:** 모임의 정원이 가득 찼을 경우에도 `MEETING_NOT_FOUND` 예외가 발생하며, 사용자에게 "모임 정원이 가득 찼습니다"와 같은 메시지가 표시될 수 있습니다. (현재 서비스 로직은 `MEETING_NOT_FOUND`를 throw하지만, 실제 사용자에게는 더 구체적인 메시지가 필요할 수 있습니다.)

## 6. `leaveMeeting(Long meetingId, Member member)`

*   **목적:** 사용자가 특정 모임에서 나갑니다.
*   **사용자 흐름:**
    *   사용자는 참여 중인 모임에서 나가고 싶을 때 이 기능을 사용합니다.
*   **성공 시:** 특별한 반환 값 없이 성공적으로 처리됩니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`:
        *   모임이 존재하지 않거나,
        *   사용자가 시스템에 존재하지 않거나,
        *   사용자가 해당 모임의 참여자가 아닐 경우,
        *   모임장이 모임을 나갈 수 없는 경우,
        *   모임 상태가 `COMPLETED` 또는 `ONGOING`이어서 취소 처리를 할 수 없는 경우,
        사용자에게 "모임에서 나갈 수 없습니다" 또는 "모임을 찾을 수 없습니다"와 같은 메시지가 표시됩니다.

## 7. `createMeeting(Member member, CreateMeetingRequest request)`

*   **목적:** 새로운 모임을 생성합니다.
*   **사용자 흐름:**
    *   사용자는 새로운 모임을 만들고 싶을 때 모임 생성 양식을 작성하고 제출합니다.
*   **성공 시:** 생성된 모임의 ID를 반환합니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`: 모임을 생성하려는 `member`가 시스템에 존재하지 않을 경우, 사용자에게 "사용자를 찾을 수 없습니다"와 같은 메시지가 표시됩니다.
    *   요청 데이터(`CreateMeetingRequest`)의 유효성 검사 실패 시 (예: 필수 필드 누락), 사용자에게 구체적인 유효성 검사 오류 메시지가 표시될 수 있습니다.

## 8. `updateMeeting(Long meetingId, Member member, UpdateMeetingRequest request)`

*   **목적:** 기존 모임의 정보를 업데이트합니다.
*   **사용자 흐름:**
    *   모임장은 자신이 생성한 모임의 정보를 수정하고 싶을 때 이 기능을 사용합니다.
*   **성공 시:** 업데이트된 모임의 ID를 반환합니다.
*   **실패 시:**
    *   `MEETING_NOT_FOUND`:
        *   모임이 존재하지 않거나,
        *   업데이트를 시도하는 `member`가 시스템에 존재하지 않거나,
        *   업데이트를 시도하는 `member`가 해당 모임의 호스트가 아닐 경우,
        *   태그 정보 조회 중 오류가 발생할 경우,
        사용자에게 "모임을 업데이트할 수 없습니다" 또는 "모임을 찾을 수 없습니다"와 같은 메시지가 표시됩니다.
    *   요청 데이터(`UpdateMeetingRequest`)의 유효성 검사 실패 시, 사용자에게 구체적인 유효성 검사 오류 메시지가 표시될 수 있습니다.

### 프론트엔드 고려사항

1.  **모호한 오류 메시지:**
    *   현재 백엔드는 모임이 없거나, 사용자가 호스트가 아니거나, 태그를 찾을 수 없는 등 다양한 실패 상황에서 모두 `MEETING_NOT_FOUND`라는 동일한 `CustomException`을 반환합니다.
    *   **영향:** 프론트엔드는 이 일반적인 오류 메시지만으로는 사용자에게 "모임 ID가 잘못되었습니다", "이 모임을 수정할 권한이 없습니다", "태그 정보가 유효하지 않습니다"와 같이 구체적인 실패 원인을 알려줄 수 없습니다. 이는 사용자 경험을 저하시키고, 프론트엔드 개발자가 문제를 디버깅하기 어렵게 만듭니다.

2.  **태그 필드의 필수성:**
    *   현재 백엔드 `updateMeeting` 로직은 `request.tag().content()`를 사용합니다. 이는 `UpdateMeetingRequest`에 `tag` 필드가 반드시 포함되어야 하며, 그 `tag` 객체 안에 `content` 리스트가 있어야 함을 의미합니다.
    *   **영향:** 만약 프론트엔드가 태그 정보를 업데이트하지 않더라도, `tag` 필드를 `null`로 보내거나 `content` 리스트를 비워 보내면 백엔드에서 `NullPointerException` 또는 `CustomException`이 발생할 수 있습니다. 프론트엔드는 태그를 수정하지 않더라도 기존 태그 정보를 그대로 포함하여 요청을 보내야 할 가능성이 높습니다.

3.  **동시성 문제 (데이터 덮어쓰기):**
    *   여러 사용자가 동시에 같은 모임을 업데이트하려고 할 경우, 백엔드에 별도의 동시성 제어(예: 낙관적 잠금) 로직이 없다면 마지막으로 저장된 변경 사항이 이전 변경 사항을 덮어쓸 수 있습니다.

### 프론트엔드 데이터 제공 방법

프론트엔드는 일반적으로 HTTP `PUT` 또는 `PATCH` 요청을 사용하여 백엔드 API에 데이터를 전송해야 합니다.

1.  **요청 URL:**
    *   업데이트할 모임을 식별하기 위해 URL 경로 또는 쿼리 파라미터에 모임 ID를 포함해야 합니다.
    *   예시: `/api/meetings/{meetingId}` (여기서 `{meetingId}`는 실제 모임 ID)

2.  **인증 정보 (헤더):**
    *   요청을 보내는 사용자를 식별하기 위한 인증 토큰(예: JWT)을 HTTP 헤더에 포함해야 합니다. 백엔드는 이 토큰을 사용하여 요청을 보낸 `Member` 객체를 가져오고, 해당 멤버가 모임의 호스트인지 확인하는 권한 검사를 수행합니다.

3.  **요청 본문 (Request Body - JSON 형식):**
    *   `UpdateMeetingRequest` DTO에 정의된 형식에 맞춰 JSON 객체를 요청 본문에 담아 보내야 합니다.
    *   **핵심:** `tag` 필드는 백엔드 로직이 `request.tag().content()`를 사용하므로, 태그를 변경하지 않더라도 **기존 태그 정보를 포함하여 보내는 것이 안전합니다.**

    **`UpdateMeetingRequest` DTO 구조:**
    ```java
    public record UpdateMeetingRequest(
        String title,
        Integer capacity,
        String description,
        LocalDateTime meetingTime,
        MeetingStatus status,
        TagList tag // 이 필드가 중요합니다.
    ) { }

    public record TagList(List<String> content) { }
    ```

    **프론트엔드에서 보낼 JSON 요청 본문 예시:**
    ```json
    {
      "title": "업데이트된 모임 제목",
      "capacity": 20,
      "description": "모임에 대한 새로운 설명입니다.",
      "meetingTime": "2025-07-15T10:00:00", // ISO 8601 형식
      "status": "ONGOING",
      "tag": {
        "content": ["업데이트된태그1", "새로운태그"]
      }
    }
    ```

    *   만약 `title`만 변경하고 싶더라도, `tag` 필드를 포함하여 위와 같은 형식으로 보내는 것이 현재 백엔드 로직에서는 가장 안전한 방법입니다. (백엔드에서 `tag` 필드가 `null`일 경우 기존 태그를 유지하는 로직이 추가된다면 달라질 수 있습니다.)

## 9. `deleteMeeting(Member member, Long meetingId)`

*   **목적:** 모임을 삭제합니다.
*   **사용자 흐름:**
    *   모임장은 자신이 생성한 모임을 삭제하고 싶을 때 이 기능을 사용합니다.
*   **현재 상태:** 서비스 로직이 구현되어 있지 않습니다. (메서드 본문이 비어 있음)
*   **성공 시:** (구현 시) 특별한 반환 값 없이 성공적으로 처리됩니다.
*   **실패 시:** (구현 시) 모임이 존재하지 않거나, 권한이 없거나, 삭제할 수 없는 상태일 경우 사용자에게 오류 메시지가 표시될 수 있습니다.

